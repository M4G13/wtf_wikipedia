{"version":3,"file":"wtf-plugin-category.js","sources":["../node_modules/slow/builds/slow.mjs","../src/random.js","../src/index.js"],"sourcesContent":["/* slow 1.1.0 MIT */\n//only do foo promises at a time.\nvar rateLimit = function rateLimit(arr, fn) {\n  var limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;\n  return new Promise(function (resolve, reject) {\n    //some validation\n    if (!arr || !fn) {\n      reject('Error: missing required parameters to rate-limit function');\n      return;\n    }\n\n    if (arr.length === 0) {\n      resolve([]);\n      return;\n    }\n\n    var results = [];\n    var n = limit - 1;\n    var pending = 0; //simple recursion, but with then/finally\n\n    var go = function go(i) {\n      pending += 1;\n      var p = fn(arr[i]);\n\n      if (!p.then) {\n        reject('Error: function must return a promise');\n        return;\n      }\n\n      p.then(function (r) {\n        results[i] = r;\n      });\n      p[\"catch\"](function (e) {\n        console.error(e);\n        results[i] = null;\n      });\n      p[\"finally\"](function () {\n        pending -= 1;\n        n += 1; //should we keep going?\n\n        if (arr.length >= n + 1) {\n          go(n);\n        } else if (pending <= 0) {\n          //no more to start - are we the last to finish?\n          resolve(results);\n        }\n      });\n    }; //fire-off first-n items\n\n\n    var init = arr.length < limit ? arr.length : limit;\n\n    for (var i = 0; i < init; i += 1) {\n      go(i);\n    }\n  });\n};\n\nvar rateLimit_1 = rateLimit;\n\nvar methods = {\n  one: function one(arr, fn) {\n    return rateLimit_1(arr, fn, 1);\n  },\n  two: function two(arr, fn) {\n    return rateLimit_1(arr, fn, 2);\n  },\n  three: function three(arr, fn) {\n    return rateLimit_1(arr, fn, 3);\n  },\n  four: function four(arr, fn) {\n    return rateLimit_1(arr, fn, 4);\n  },\n  five: function five(arr, fn) {\n    return rateLimit_1(arr, fn, 5);\n  },\n  ten: function ten(arr, fn) {\n    return rateLimit_1(arr, fn, 10);\n  },\n  fifteen: function fifteen(arr, fn) {\n    return rateLimit_1(arr, fn, 15);\n  }\n};\nmethods.serial = methods.one;\nmethods.linear = methods.one;\nmethods.crawl = methods.three;\nmethods.walk = methods.five;\nmethods.run = methods.ten;\nmethods.sprint = methods.fifteen;\nvar src = methods;\n\nexport default src;\n","const defaults = {\n  lang: 'en',\n  wiki: 'wikipedia',\n  domain: null,\n  path: 'w/api.php' //some 3rd party sites use a weird path\n}\nconst isObject = function (obj) {\n  return obj && Object.prototype.toString.call(obj) === '[object Object]'\n}\n\nconst fetchRandom = function (lang, options, http) {\n  options = options || {}\n  options = Object.assign({}, defaults, options)\n  //support lang 2nd param\n  if (typeof lang === 'string') {\n    options.lang = lang\n  } else if (isObject(lang)) {\n    options = Object.assign(options, lang)\n  }\n\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += `format=json&action=query&generator=random&grnnamespace=14&prop=revisions&grnlimit=1&origin=*`\n\n  return http(url)\n    .then((res) => {\n      try {\n        let o = res.query.pages\n        let key = Object.keys(o)[0]\n        return o[key].title\n      } catch (e) {\n        throw e\n      }\n    })\n    .catch((e) => {\n      console.error(e)\n      return null\n    })\n}\nmodule.exports = fetchRandom\n","const slow = require('slow')\nconst random = require('./random')\n\nconst chunkBy = function (arr, chunkSize = 5) {\n  let groups = []\n  for (let i = 0; i < arr.length; i += chunkSize) {\n    groups.push(arr.slice(i, i + chunkSize))\n  }\n  return groups\n}\n\nconst fetchCat = function (wtf, cat, lang, opts) {\n  if (!cat) {\n    return { docs: [], categories: [] }\n  }\n  return wtf.category(cat, lang).then((resp) => {\n    let pages = resp.pages.map((o) => o.title)\n    let groups = chunkBy(pages)\n\n    const doit = function (group) {\n      return wtf.fetch(group, opts) //returns a promise\n    }\n    //only allow three requests at a time\n    return slow.three(groups, doit).then((responses) => {\n      //flatten the results\n      let docs = [].concat.apply([], responses)\n      return {\n        docs: docs,\n        categories: resp.categories\n      }\n    })\n  })\n}\n\nconst plugin = function (models) {\n  models.wtf.parseCategory = function (cat, lang, opts) {\n    return fetchCat(models.wtf, cat, lang, opts)\n  }\n  models.wtf.randomCategory = function (lang, opts) {\n    return random(lang, opts, models.http)\n  }\n  models.wtf.fetchCategory = models.wtf.parseCategory\n}\nmodule.exports = plugin\n"],"names":["rateLimit","arr","fn","limit","arguments","length","undefined","Promise","resolve","reject","results","n","pending","go","i","p","then","r","e","console","error","init","rateLimit_1","methods","one","two","three","four","five","ten","fifteen","serial","linear","crawl","walk","run","sprint","src","defaults","lang","wiki","domain","path","isObject","obj","Object","prototype","toString","call","fetchRandom","options","http","assign","url","res","o","query","pages","key","keys","title","catch","random","slow","require$$0","require$$1","chunkBy","chunkSize","groups","push","slice","fetchCat","wtf","cat","opts","docs","categories","category","resp","map","doit","group","fetch","responses","concat","apply","plugin","models","parseCategory","randomCategory","fetchCategory"],"mappings":"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"}