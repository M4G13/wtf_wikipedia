!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).wtfApi=e()}(this,(function(){"use strict";const t=function(t){let e,n=t.userAgent||t["User-Agent"]||t["Api-User-Agent"]||"User of the wtf_wikipedia library";return e=t.noOrigin?"":t.origin||t.Origin||"*",{method:"GET",headers:{"Content-Type":"application/json","Api-User-Agent":n,"User-Agent":n,Origin:e,"Accept-Encoding":"gzip"},redirect:"follow"}};function e(t=""){return t=(t=t.replace(/ /g,"_")).trim(),t=encodeURIComponent(t)}const n={lang:"en",path:"w/api.php"};function r(t){return Object.entries(t).map((([t,e])=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&")}function i(e,n,r,i){return r(e,t(n)).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?{pages:[],cursor:null}:{pages:t.query.pages[e[0]][i]||[],cursor:t.continue}}))}const o={action:"query",rdnamespace:0,prop:"redirects",rdlimit:500,format:"json",origin:"*",redirects:!0},c=function(t,n,i){let c=`https://${n.lang}.wikipedia.org/${n.path}?`;return n.domain&&(c=`https://${n.domain}/${n.path}?`),c+=r(o),c+="&titles="+e(t),i&&(c+=i),c},a=async function(t,e,r){e={...n,...e};let o=[],a=!0,s="";for(;a;){let n=c(t,e,s),{pages:u,cursor:p}=await i(n,e,r,"redirects");o=o.concat(u),p&&p.rdcontinue?s="&rdcontinue="+p.lhcontinue:a=!1}return o},s={action:"query",lhnamespace:0,prop:"linkshere",lhshow:"!redirect",lhlimit:500,format:"json",origin:"*",redirects:!0},u=function(t,n,i){let o=`https://${n.lang}.wikipedia.org/${n.path}?`;return n.domain&&(o=`https://${n.domain}/${n.path}?`),o+=r(s),o+="&titles="+e(t),i&&(o+=i),o},p=async function(t,e,r){e={...n,...e};let o=[],c=!0,a="";for(;c;){let n=u(t,e,a),{pages:s,cursor:p}=await i(n,e,r,"linkshere");o=o.concat(s),p&&p.lhcontinue?a="&lhcontinue="+p.lhcontinue:c=!1}return o},l={action:"query",prop:"pageviews",format:"json",origin:"*",redirects:!0},f=function(i,o,c){o={...n,...o};return c(function(t,n,i){let o=`https://${n.lang}.wikipedia.org/${n.path}?`;return n.domain&&(o=`https://${n.domain}/${n.path}?`),o+=r(l),o+="&titles="+e(t),i&&(o+=i),o}(i.title(),o),t(o)).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?[]:t.query.pages[e[0]].pageviews||[]}))},g={action:"query",tinamespace:0,prop:"transcludedin",tilimit:500,format:"json",origin:"*",redirects:!0},h=function(t,n,i){let o=`https://${n.lang}.wikipedia.org/${n.path}?`;return n.domain&&(o=`https://${n.domain}/${n.path}?`),o+=r(g),o+="&titles="+e(t),i&&(o+=i),o},m=/^(category|catégorie|kategorie|categoría|categoria|categorie|kategoria)/i,d={action:"query",list:"categorymembers",cmlimit:500,cmtype:"page|subcat",cmnamespace:"0|14",format:"json",origin:"*",redirects:!0},y=function(e,n,r,i){return r(e,t(n)).then((t=>{let e=Object.keys(t.query[i]||{});return 0===e.length?{pages:[],cursor:null}:{pages:e.map((e=>t.query[i][e])),cursor:t.continue}}))},w=function(t,n,i){let o=`https://${n.lang}.wikipedia.org/${n.path}?`;return n.domain&&(o=`https://${n.domain}/${n.path}?`),o+=r(d),!1===m.test(t)&&(t="Category:"+t),o+="&cmtitle="+e(t),o+="&cmprop=ids|title|type",i&&(o+=i),o},$=async function(t,e,n){let r=[],i=!0,o="";for(;i;){let c=w(t,e,o),{pages:a,cursor:s}=await y(c,e,n,"categorymembers");r=r.concat(a),s&&s.cmcontinue?o="&cmcontinue="+s.cmcontinue:i=!1}return r};async function v(t,e,n,r,i,o,c){let a=await $(t,e,c);if(void 0===r||i<r){let t=a.filter((t=>"subcat"===t.type));n&&(t=t.filter((t=>!n.includes(t.title)))),t=t.filter((t=>!o.includes(t.title))),o.push(...t.map((t=>t.title)));const s=[];for(let a of t){let t=await v(a.title,e,n,r,i+1,o,c);s.push(t)}return a.concat(...s)}return a}async function j(t,e,r){let i=(e={...n,...e})?.categoryExclusions,o=!0===e?.recursive,c=e?.maxDepth;return o?await v(t,e,i,c,0,[],r):await $(t,e,r)}const b={action:"query",generator:"random",grnnamespace:"0",prop:"revisions",rvprop:"content",grnlimit:"1",rvslots:"main",format:"json",origin:"*",redirects:"true"},k=async function(e,i,o){let c={...n,...e},a=function(t){let e=`https://${t.lang}.wikipedia.org/${t.path}?`;return t.domain&&(e=`https://${t.domain}/${t.path}?`),e+=r(b),e}(c),s={};try{s=await function(e,n,r){return r(e,t(n)).then((t=>{let e=Object.keys(t.query.pages||{});return 0===e.length?{pages:[],cursor:null}:t.query.pages[e[0]]}))}(a,c,i)||{}}catch(t){console.error(t)}let u=s.title,p="";return s.revisions&&s.revisions[0]&&s.revisions[0].slots&&(p=s.revisions[0].slots.main["*"]||""),o(p,{title:u})},q={format:"json",action:"query",generator:"random",grnnamespace:14,prop:"revisions",grnlimit:1,origin:"*"};var O=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return new Promise((function(r,i){if(t&&e)if(0!==t.length)for(var o=[],c=n-1,a=0,s=function n(s){a+=1;var u=e(t[s]);u.then?(u.then((function(t){o[s]=t})),u.catch((function(t){console.error(t),o[s]=null})),u.finally((function(){a-=1,c+=1,t.length>=c+1?n(c):a<=0&&r(o)}))):i("Error: function must return a promise")},u=t.length<n?t.length:n,p=0;p<u;p+=1)s(p);else r([]);else i("Error: missing required parameters to rate-limit function")}))},A={one:function(t,e){return O(t,e,1)},two:function(t,e){return O(t,e,2)},three:function(t,e){return O(t,e,3)},four:function(t,e){return O(t,e,4)},five:function(t,e){return O(t,e,5)},ten:function(t,e){return O(t,e,10)},fifteen:function(t,e){return O(t,e,15)}};A.serial=A.one,A.linear=A.one,A.crawl=A.three,A.walk=A.five,A.run=A.ten,A.sprint=A.fifteen;var R=A;const U=function(t,e,n){var r;t[0]&&((r=t[0])&&"[object Object]"===Object.prototype.toString.call(r))&&(t=t.map((t=>t.title)));let i=function(t,e=5){let n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}(t);return R.three(i,(function(t){return n.fetch(t,e)})).then((t=>t.reduce(((t,e)=>t=t.concat(e)))))};return function(e){e.Doc.prototype.getRedirects=function(){return a(this.title(),this.options(),e.http)},e.Doc.prototype.getIncoming=function(){return p(this.title(),this.options(),e.http)},e.Doc.prototype.getPageViews=function(){return f(this,this.options(),e.http)},e.wtf.getRandomPage=function(t){return k(t,e.http,e.wtf)},e.wtf.getRandomCategory=function(i){return function(e={},i){let o=`https://${(e=Object.assign({},n,e)).lang}.wikipedia.org/${e.path}?`;return e.domain&&(o=`https://${e.domain}/${e.path}?`),o+=r(q),i(o,t(e)).then((t=>{try{let e=t.query.pages;return e[Object.keys(e)[0]].title}catch(t){throw t}})).catch((t=>(console.error(t),null)))}(i,e.http)},e.wtf.getTemplatePages=function(t,r){return async function(t,e,r){let o={...n,...e},c=[],a=!0,s="";for(;a;){let e=h(t,o,s),{pages:n,cursor:u}=await i(e,o,r,"transcludedin");c=c.concat(n),u&&u.ticontinue?s="&ticontinue="+u.ticontinue:a=!1}return c}(t,r,e.http)},e.wtf.getCategoryPages=function(t,n){return j(t,n,e.http)},e.wtf.fetchList=function(t,n){return U(t,n,e.wtf)},e.wtf.getIncoming=function(t,n){return p(t,n,e.http)},e.wtf.getRedirects=function(t,n){return a(t,n,e.http)},e.wtf.random=e.wtf.getRandomPage}}));
