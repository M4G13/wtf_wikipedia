!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).wtfImage=n()}(this,(function(){"use strict";function t(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&1===Object.keys(t).length?t.default:t}var n={normalize:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t=t.replace(/ /g,"_"),t=t.trim(),t=encodeURIComponent(t),t},defaults:{lang:"en",path:"w/api.php"},toUrlParams:function(t){return Object.entries(t).map((t=>{let[n,e]=t;return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e))})).join("&")},fetchOne:function(t,n,e){return n(t).then((t=>{let n=Object.keys(t.query.pages||{});return 0===n.length?{pages:[],cursor:null}:{pages:t.query.pages[n[0]][e]||[],cursor:t.continue}}))}};const{normalize:e,defaults:r,toUrlParams:o,fetchOne:c}=n,a={action:"query",rdnamespace:0,prop:"redirects",rdlimit:500,format:"json",origin:"*",redirects:!0},i=function(t,n,r){let c="https://".concat(n.lang,".wikipedia.org/").concat(n.path,"?");return n.domain&&(c="https://".concat(n.domain,"/").concat(n.path,"?")),c+=o(a),c+="&titles=".concat(e(t)),r&&(c+=r),c};var u=async function(t,n){let e=[],o=!0,a="";for(;o;){let u=i(t,r,a),{pages:s,cursor:l}=await c(u,n,"redirects");e=e.concat(s),l&&l.rdcontinue?a="&rdcontinue="+l.lhcontinue:o=!1}return e};const{normalize:s,defaults:l,toUrlParams:p,fetchOne:f}=n,h={action:"query",lhnamespace:0,prop:"linkshere",lhshow:"!redirect",lhlimit:500,format:"json",origin:"*",redirects:!0},g=function(t,n,e){let r="https://".concat(n.lang,".wikipedia.org/").concat(n.path,"?");return n.domain&&(r="https://".concat(n.domain,"/").concat(n.path,"?")),r+=p(h),r+="&titles=".concat(s(t)),e&&(r+=e),r};var m=async function(t,n){let e=[],r=!0,o="";for(;r;){let c=g(t,l,o),{pages:a,cursor:i}=await f(c,n,"linkshere");e=e.concat(a),i&&i.lhcontinue?o="&lhcontinue="+i.lhcontinue:r=!1}return e};const{normalize:d,defaults:y,toUrlParams:w}=n,v={action:"query",prop:"pageviews",format:"json",origin:"*",redirects:!0};var j=function(t,n){return n(function(t,n,e){let r="https://".concat(n.lang,".wikipedia.org/").concat(n.path,"?");return n.domain&&(r="https://".concat(n.domain,"/").concat(n.path,"?")),r+=w(v),r+="&titles=".concat(d(t)),e&&(r+=e),r}(t.title(),y)).then((t=>{let n=Object.keys(t.query.pages||{});return 0===n.length?[]:t.query.pages[n[0]].pageviews||[]}))};const{normalize:b,defaults:q,toUrlParams:O,fetchOne:k}=n,P={action:"query",tinamespace:0,prop:"transcludedin",tilimit:500,format:"json",origin:"*",redirects:!0},U=function(t,n,e){let r="https://".concat(n.lang,".wikipedia.org/").concat(n.path,"?");return n.domain&&(r="https://".concat(n.domain,"/").concat(n.path,"?")),r+=O(P),r+="&titles=".concat(b(t)),e&&(r+=e),r};var z=async function(t,n,e){let r=[],o=!0,c="";for(;o;){let n=U(t,q,c),{pages:a,cursor:i}=await k(n,e,"transcludedin");r=r.concat(a),i&&i.ticontinue?c="&ticontinue="+i.ticontinue:o=!1}return r};const{normalize:C,defaults:R,toUrlParams:I}=n,_={action:"query",list:"categorymembers",cmlimit:500,cmtype:"page|subcat",cmnamespace:0,format:"json",origin:"*",redirects:!0},D=function(t,n,e){return n(t).then((t=>{let n=Object.keys(t.query[e]||{});return 0===n.length?{pages:[],cursor:null}:{pages:n.map((n=>t.query[e][n])),cursor:t.continue}}))},T=function(t,n,e){let r="https://".concat(n.lang,".wikipedia.org/").concat(n.path,"?");return n.domain&&(r="https://".concat(n.domain,"/").concat(n.path,"?")),r+=I(_),!1===/^Category/i.test(t)&&(t="Category:"+t),r+="&cmtitle=".concat(C(t)),e&&(r+=e),r};var x=async function(t,n,e){n={...R,...n};let r=[],o=!0,c="";for(;o;){let a=T(t,n,c),{pages:i,cursor:u}=await D(a,e,"categorymembers");r=r.concat(i),u&&u.cmcontinue?c="&cmcontinue="+u.lhcontinue:o=!1}return r};const{defaults:E,toUrlParams:L}=n,S={action:"query",generator:"random",grnnamespace:"0",prop:"pageprops",grnlimit:"1",rvslots:"main",format:"json",origin:"*",redirects:"true"};var V=async function(t,n){let e=function(t){let n="https://".concat(t.lang,".wikipedia.org/").concat(t.path,"?");return t.domain&&(n="https://".concat(t.domain,"/").concat(t.path,"?")),n+=L(S),n}(E);return await function(t,n){return n(t).then((t=>{let n=Object.keys(t.query.pages||{});return 0===n.length?{pages:[],cursor:null}:t.query.pages[n[0]]}))}(e,n)};const{defaults:A,toUrlParams:B}=n,F={format:"json",action:"query",generator:"random",grnnamespace:14,prop:"revisions",grnlimit:1,origin:"*"};var G=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;t=Object.assign({},A,t);let e="https://".concat(t.lang,".wikipedia.org/").concat(t.path,"?");return t.domain&&(e="https://".concat(t.domain,"/").concat(t.path,"?")),e+=B(F),n(e).then((t=>{try{let n=t.query.pages;return n[Object.keys(n)[0]].title}catch(t){throw t}})).catch((t=>(console.error(t),null)))},H=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return new Promise((function(r,o){if(t&&n)if(0!==t.length)for(var c=[],a=e-1,i=0,u=function e(u){i+=1;var s=n(t[u]);s.then?(s.then((function(t){c[u]=t})),s.catch((function(t){console.error(t),c[u]=null})),s.finally((function(){i-=1,a+=1,t.length>=a+1?e(a):i<=0&&r(c)}))):o("Error: function must return a promise")},s=t.length<e?t.length:e,l=0;l<s;l+=1)u(l);else r([]);else o("Error: missing required parameters to rate-limit function")}))},J={one:function(t,n){return H(t,n,1)},two:function(t,n){return H(t,n,2)},three:function(t,n){return H(t,n,3)},four:function(t,n){return H(t,n,4)},five:function(t,n){return H(t,n,5)},ten:function(t,n){return H(t,n,10)},fifteen:function(t,n){return H(t,n,15)}};J.serial=J.one,J.linear=J.one,J.crawl=J.three,J.walk=J.five,J.run=J.ten,J.sprint=J.fifteen;var K=J;const M=t(Object.freeze({__proto__:null,default:K}));const N=u,Q=m,W=j,X=z,Y=x,Z=V,$=G,tt=function(t,n,e){var r;t[0]&&((r=t[0])&&"[object Object]"===Object.prototype.toString.call(r))&&(t=t.map((t=>t.title)));let o=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,e=[];for(let r=0;r<t.length;r+=n)e.push(t.slice(r,r+n));return e}(t);return M.three(o,(function(t){return e.fetch(t,n)})).then((t=>t.reduce(((t,n)=>t=t.concat(n)))))};return function(t){t.Doc.prototype.getRedirects=function(){return N(this.title(),t.http)},t.Doc.prototype.getIncoming=function(){return Q(this.title(),t.http)},t.Doc.prototype.getPageViews=function(){return W(this,t.http)},t.wtf.getRandomPage=function(n){return Z(n,t.http)},t.wtf.getRandomCategory=function(n){return $(n,t.http)},t.wtf.getTemplatePages=function(n,e){return X(n,e,t.http)},t.wtf.getCategoryPages=function(n,e){return Y(n,e,t.http)},t.wtf.fetchList=function(n,e){return tt(n,e,t.wtf)},t.wtf.getIncoming=function(n){return Q(n,t.http)},t.wtf.getRedirects=function(n){return N(n,t.http)}}}));
